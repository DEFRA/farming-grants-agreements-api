{
  "basePath": "/",
  "info": {
    "title": "Agreement Service API",
    "version": "1.0.0",
    "description": "Farming Grants Agreements API"
  },
  "swagger": "2.0",
  "host": "MacBook-Pro-2.local:3555",
  "schemes": [
    "http"
  ],
  "tags": [],
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check endpoint",
        "operationId": "getHealth",
        "description": "Returns the service health status and version. Used by the platform to verify the service is running. Returns 200 if MongoDB connection is healthy, 503 if unable to connect.",
        "tags": [
          "health"
        ],
        "responses": {
          "200": {
            "schema": {
              "$ref": "#/definitions/HealthResponse"
            },
            "description": "Successful"
          },
          "503": {
            "schema": {
              "$ref": "#/definitions/HealthErrorResponse"
            },
            "description": "Service Unavailable"
          }
        }
      }
    },
    "/{agreementId}": {
      "get": {
        "summary": "Get agreement by ID",
        "operationId": "getAgreementid",
        "description": "Returns agreement data for the specified agreement ID. This endpoint supports both Grants UI and Entra authentication methods.",
        "parameters": [
          {
            "type": "string",
            "description": "Unique agreement identifier (e.g. ESFIG-AB1234-AB1/2/A123456)",
            "name": "agreementId",
            "in": "path",
            "required": true
          }
        ],
        "tags": [
          "agreement"
        ],
        "responses": {
          "200": {
            "schema": {
              "$ref": "#/definitions/AgreementResponse"
            },
            "description": "Successful"
          }
        }
      }
    },
    "/": {
      "get": {
        "summary": "Get current user agreement",
        "operationId": "get",
        "description": "Returns agreement data for the authenticated user based on JWT credentials. The user must be authenticated via the Grants UI JWT token.",
        "tags": [
          "agreement"
        ],
        "responses": {
          "200": {
            "schema": {
              "$ref": "#/definitions/AgreementResponse"
            },
            "description": "Successful"
          }
        }
      },
      "post": {
        "summary": "Accept agreement offer",
        "operationId": "post",
        "description": "Accepts the agreement offer for the authenticated user. This endpoint updates the payment hub, records the signature date, and publishes a status update event to SNS. Only agreements with status \"offered\" can be accepted.",
        "tags": [
          "agreement"
        ],
        "responses": {
          "200": {
            "schema": {
              "$ref": "#/definitions/AcceptOfferResponse"
            },
            "description": "Successful"
          }
        }
      }
    },
    "/api/test/agreement": {
      "get": {
        "summary": "Get test agreement",
        "operationId": "getApiTestAgreement",
        "description": "Retrieves agreement data by agreement ID for testing purposes. Supports multiple IDs via comma-delimited values or repeated query params (e.g. ?id=123,456 or ?id=123&id=456).",
        "parameters": [
          {
            "type": "string",
            "x-alternatives": [
              {
                "type": "string"
              },
              {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "collectionFormat": "multi",
                "name": "id"
              }
            ],
            "name": "id",
            "in": "query",
            "required": true
          }
        ],
        "tags": [
          "test"
        ],
        "responses": {
          "200": {
            "description": "Array of agreement data objects",
            "schema": {
              "$ref": "#/definitions/AgreementArrayResponse"
            }
          }
        }
      }
    },
    "/api/test/invoice": {
      "get": {
        "summary": "Get test invoice",
        "operationId": "getApiTestInvoice",
        "description": "Retrieves invoice data by agreement number for testing purposes. Returns the invoice document from the database.",
        "parameters": [
          {
            "type": "string",
            "description": "Agreement number to retrieve invoice for",
            "name": "agreementNumber",
            "in": "query",
            "required": true
          }
        ],
        "tags": [
          "test"
        ],
        "responses": {
          "200": {
            "schema": {
              "$ref": "#/definitions/InvoiceResponse"
            },
            "description": "Successful"
          }
        }
      }
    },
    "/api/test/unauthorized": {
      "get": {
        "summary": "Test unauthorized response",
        "operationId": "getApiTestUnauthorized",
        "description": "Test endpoint that always returns a 401 Unauthorized error. Useful for testing error handling and JSON error response formatting in clients.",
        "tags": [
          "test"
        ],
        "responses": {
          "401": {
            "schema": {
              "$ref": "#/definitions/UnauthorizedResponse"
            },
            "description": "Unauthorized"
          }
        }
      }
    },
    "/{agreementId}/{version}/download": {
      "get": {
        "summary": "Download agreement PDF",
        "operationId": "getAgreementidVersionDownload",
        "description": "Downloads the agreement PDF document for the specified agreement ID and version from S3. The PDF filename follows the pattern {agreementId}-{version}.pdf.",
        "parameters": [
          {
            "type": "string",
            "description": "Unique agreement identifier (e.g. ESFIG-AB1234-AB1/2/A123456)",
            "name": "agreementId",
            "in": "path",
            "required": true
          },
          {
            "type": "integer",
            "description": "Agreement version number (starts at 1)",
            "minimum": 1,
            "name": "version",
            "in": "path",
            "required": true
          }
        ],
        "tags": [
          "agreement"
        ],
        "responses": {
          "default": {
            "schema": {
              "type": "string"
            },
            "description": "Successful"
          }
        }
      }
    },
    "/api/test/populate-agreements": {
      "post": {
        "summary": "Populate agreements with sample data for performance testing",
        "operationId": "postApiTestPopulateagreements",
        "tags": [
          "test"
        ],
        "responses": {
          "default": {
            "schema": {
              "type": "string"
            },
            "description": "Successful"
          }
        }
      }
    },
    "/api/test/queue-message/{queueName}": {
      "post": {
        "summary": "Post test queue message",
        "operationId": "postApiTestQueuemessageQueuename",
        "description": "Posts a test message to the specified SQS queue for testing. Useful for simulating agreement creation events. For create_agreement queue, returns the created agreement data after processing.",
        "parameters": [
          {
            "type": "string",
            "description": "Name of the SQS queue to post the message to (defaults to create_agreement)",
            "default": "create_agreement",
            "name": "queueName",
            "in": "path"
          },
          {
            "in": "body",
            "name": "body",
            "schema": {
              "$ref": "#/definitions/QueueMessagePayload"
            }
          }
        ],
        "tags": [
          "test"
        ],
        "responses": {
          "200": {
            "schema": {
              "$ref": "#/definitions/QueueMessageResponse"
            },
            "description": "Successful"
          }
        }
      }
    },
    "/api/test/unaccept-offer/{agreementId}": {
      "post": {
        "summary": "Unaccept agreement offer",
        "operationId": "postApiTestUnacceptofferAgreementid",
        "description": "Reverts an accepted agreement offer back to offered status. This is a test-only endpoint for resetting agreement state during testing.",
        "parameters": [
          {
            "type": "string",
            "description": "Unique agreement identifier to revert from accepted to offered status",
            "name": "agreementId",
            "in": "path",
            "required": true
          }
        ],
        "tags": [
          "test"
        ],
        "responses": {
          "200": {
            "schema": {
              "$ref": "#/definitions/UnacceptOfferResponse"
            },
            "description": "Successful"
          }
        }
      }
    }
  },
  "definitions": {
    "message": {
      "type": "string",
      "description": "Health check status message",
      "enum": [
        "success"
      ]
    },
    "HealthResponse": {
      "type": "object",
      "properties": {
        "message": {
          "$ref": "#/definitions/message"
        },
        "version": {
          "type": "string",
          "description": "Current service version from package.json"
        }
      },
      "required": [
        "message",
        "version"
      ]
    },
    "HealthErrorResponse": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string",
          "description": "Error message describing the health check failure"
        },
        "error": {
          "type": "string",
          "description": "Detailed error information"
        },
        "version": {
          "type": "string",
          "description": "Current service version from package.json"
        }
      },
      "required": [
        "message"
      ]
    },
    "agreementData": {
      "type": "object",
      "description": "The agreement data object"
    },
    "source": {
      "type": "string",
      "description": "Authentication source",
      "enum": [
        "grants-ui",
        "entra"
      ]
    },
    "auth": {
      "type": "object",
      "description": "Authentication metadata",
      "properties": {
        "source": {
          "$ref": "#/definitions/source"
        }
      }
    },
    "AgreementResponse": {
      "type": "object",
      "properties": {
        "agreementData": {
          "$ref": "#/definitions/agreementData"
        },
        "auth": {
          "$ref": "#/definitions/auth"
        }
      }
    },
    "Model1": {
      "type": "object"
    },
    "AgreementArrayResponse": {
      "type": "array",
      "description": "Array of agreement data objects",
      "items": {
        "$ref": "#/definitions/Model1"
      }
    },
    "InvoiceResponse": {
      "type": "object",
      "properties": {
        "agreementNumber": {
          "type": "string",
          "description": "Agreement number"
        },
        "invoiceNumber": {
          "type": "string",
          "description": "Invoice number"
        },
        "amount": {
          "type": "number",
          "description": "Invoice amount"
        },
        "status": {
          "type": "string",
          "description": "Invoice status"
        }
      }
    },
    "error": {
      "type": "string",
      "description": "Error type",
      "enum": [
        "Unauthorized"
      ]
    },
    "UnauthorizedResponse": {
      "type": "object",
      "properties": {
        "statusCode": {
          "type": "number",
          "description": "HTTP status code",
          "enum": [
            401
          ]
        },
        "error": {
          "$ref": "#/definitions/error"
        },
        "message": {
          "type": "string",
          "description": "Error message"
        }
      }
    },
    "Model2": {
      "type": "object",
      "description": "The updated agreement data after acceptance"
    },
    "AcceptOfferResponse": {
      "type": "object",
      "properties": {
        "agreementData": {
          "$ref": "#/definitions/Model2"
        }
      }
    },
    "identifiers": {
      "type": "object",
      "description": "Identifiers for the agreement",
      "properties": {
        "sbi": {
          "type": "string",
          "description": "Single Business Identifier"
        }
      }
    },
    "data": {
      "type": "object",
      "description": "Message data payload",
      "properties": {
        "identifiers": {
          "$ref": "#/definitions/identifiers"
        }
      }
    },
    "QueueMessagePayload": {
      "type": "object",
      "description": "SQS message body to post to the queue",
      "properties": {
        "data": {
          "$ref": "#/definitions/data"
        }
      }
    },
    "Model3": {
      "type": "object",
      "description": "Created agreement data (only for create_agreement queue)"
    },
    "QueueMessageResponse": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string",
          "description": "Success message"
        },
        "agreementData": {
          "$ref": "#/definitions/Model3"
        }
      }
    },
    "Model4": {
      "type": "string",
      "description": "Success confirmation message",
      "enum": [
        "Offer unaccepted"
      ]
    },
    "UnacceptOfferResponse": {
      "type": "object",
      "properties": {
        "message": {
          "$ref": "#/definitions/Model4"
        }
      }
    }
  }
}