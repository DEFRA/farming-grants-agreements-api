{% extends "govuk/template.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}

{% block head %}
<link rel="stylesheet" href="/assets/css/govuk-frontend.min.css">
{% endblock %}

{% block header %}
  {{ govukHeader({
    homepageUrl: "#",
    containerClasses: "govuk-width-container",
    serviceName: "Rural payments",
    serviceUrl: "#",
    navigation: [
      {
        href: "#",
        text: "Homepage",
        active: true
      },
      {
        href: "/landing",
        text: "Business overview"
      }
    ]
  }) }}
{% endblock %}

{% block content %}
  <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
  <div class="govuk-width-container" style="border-bottom:1px solid #b1b4b6; padding-bottom: 8px; margin-bottom: 24px;">
    <div style="display: flex; justify-content: space-between; align-items: baseline;">
      <span id="farmName" class="govuk-body govuk-!-font-size-24"><strong>{{ company }}</strong></span>
      <span id="farmerName" class="govuk-body govuk-!-font-size-24"><strong>Alfred Waldron</strong></span>
    </div>
    <div id="sbi" class="govuk-body govuk-!-margin-top-1 govuk-!-margin-bottom-0">Single business identifier (SBI): {{ sbi }}</div>
  </div>

  <h1 class="govuk-heading-xl">Review your funding offer</h1>

  <h2 class="govuk-heading-l govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Actions</h2>
  <table class="govuk-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Action</th>
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Code</th>
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Land parcel</th>
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Quantity</th>
      </tr>
    </thead>
    <tbody class="govuk-table__body">
      {% for action in actions %}
      <tr class="govuk-table__row" id="actionRow{{ loop.index }}">
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="actionTableActionRow{{ loop.index }}">{{ action.name }}</td>
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="actionTableCodeRow{{ loop.index }}">{{ action.code }}</td>
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="actionTableLandParcelRow{{ loop.index }}">{{ action.landParcel }}</td>
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="actionTableQuantityRow{{ loop.index }}">{{ action.quantity }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <p class="govuk-body govuk-!-font-size-24" style="line-height:30px;">
    If you accept this offer, these are the payments for the total quantity of land in each action.
  </p>

  <h2 class="govuk-heading-l govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Payments</h2>
  <table class="govuk-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Action</th>
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Code</th>
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Payment rate for each year</th>
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Quarterly payment</th>
        <th scope="col" class="govuk-table__header govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px;">Yearly payment</th>
      </tr>
    </thead>
    <tbody class="govuk-table__body">
      {% for payment in payments %}
      <tr class="govuk-table__row" id="paymentRow{{ loop.index }}">
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="paymentsTableActionRow{{ loop.index }}">{{ payment.name }}</td>
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="paymentsTableCodeRow{{ loop.index }}">{{ payment.code }}</td>
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="paymentsTablePaymentRateForEachYearRow{{ loop.index }}">{{ payment.rate }}</td>
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="paymentsTableQuarterlyPaymentRow{{ loop.index }}">{{ payment.quarterly }}</td>
        <td class="govuk-table__cell govuk-!-font-size-24" style="line-height:30px;" id="paymentsTableYearlyPaymentRow{{ loop.index }}">{{ payment.yearly }}</td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4" class="govuk-table__cell govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px; text-align:right; border-bottom: none;">Total payment</td>
        <td class="govuk-table__cell govuk-!-font-size-24 govuk-!-font-weight-bold" style="line-height:30px; text-align:right; border-bottom: none;" id="paymentsTableTotalYearlyPayment">{{ totalYearly }}</td>
      </tr>
    </tfoot>
  </table>

  {{ govukButton({
    text: "Continue",
    classes: "govuk-button govuk-button--primary",
    attributes: {
      onclick: "return false;"
    }
  }) }}

  {#
  {% if agreementStatus === 'offered' %}
      <div class="govuk-width-container">
          <main class="govuk-main-wrapper" id="main-content" role="main">
              <h1 class="govuk-heading-xl">Read and accept your agreement</h1>

              <section>
                  {{ agreementDocument | safe }}
              </section>

              {% if agreementStatus === 'offered' %}
              <section class="accept-section">
                  <form method="post" action="#" id="accept-agreement-form">
                      <input type="hidden" name="agreementNumber" value="{{agreementNumber}}">
                      <p id="accept-agreement-error" class="govuk-error-message"></p>
                      {{ govukButton({
                          text: "Accept and continue"
                      }) }}
                  </form>

                  <div class="govuk-inset-text">
                      <a href="#" onclick="toggleContact(event)">Need to change your offer?</a>
                      <div id="rpa-contact" style="display: none;">
                        <p>Contact RPA — changes can't be made online.</p>
                        <ul>
                          <li><strong>Phone:</strong> 03000 200 301</li>
                          <li><strong>Email:</strong> ruralpayments@defra.gov.uk</li>
                          <li><strong>Hours:</strong> Mon–Fri, 8:30am–5pm</li>
                        </ul>
                      </div>

                      <script>
                      function toggleContact(event) {
                        event.preventDefault();
                        const el = document.getElementById('rpa-contact');
                        el.style.display = el.style.display === 'none' ? 'block' : 'none';
                      }
                      </script>
                  </div>
              </section>

              <script src="/assets/js/accept-agreement.js"></script>
              {% endif %}
          </main>
      </div>

  {% else %}
      <div class="govuk-width-container">
          <main class="govuk-main-wrapper" id="main-content" role="main">
              <div class="govuk-grid-row" role="main">
                  <div class="govuk-grid-column-two-thirds">
                      <h1 class="govuk-heading-l">
                          Agreement accepted
                      </h1>
                      <p class="govuk-body">Your agreement is now live.</p>
                  </div>
              </div>
          </main>
      </div>
  {% endif %}
  #}
{% endblock %}

{% block footer %}
    <footer class="govuk-footer" role="contentinfo">
        <div class="govuk-width-container">

            <div class="govuk-footer__meta">
            <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

                <h2 class="govuk-visually-hidden">Footer links</h2>

                    <ul class="govuk-footer__inline-list">

                        <li class="govuk-footer__inline-list-item">
                        <a class="govuk-footer__link" href="/manage-prototype/clear-data">
                            Clear data
                        </a>
                        </li>

                    </ul>



                <svg
                aria-hidden="true"
                focusable="false"
                class="govuk-footer__licence-logo"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 483.2 195.7"
                height="17"
                width="41"
                >
                <path
                    fill="currentColor"
                    d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
                />
                </svg>
                <span class="govuk-footer__licence-description">

                    All content is available under the
                    <a
                    class="govuk-footer__link"
                    href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
                    rel="license"
                    >Open Government Licence v3.0</a>, except where otherwise stated

                </span>
            </div>
            <div class="govuk-footer__meta-item">
                <a
                class="govuk-footer__link govuk-footer__copyright-logo"
                href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
                >© Crown copyright</a>
            </div>
            </div>
        </div>
        </footer>
{% endblock %}

{% block bodyEnd %}
<script type="module" src="/assets/js/govuk-frontend.min.js"></script>
<script type="module">
    import { initAll } from '/assets/js/govuk-frontend.min.js'
    initAll()
</script>
{% endblock %}
